name: Accessibility Testing

on:
  push:
    branches: [ main, gh-pages ]
  pull_request:
    branches: [ main ]
  schedule:
    - cron: '0 3 * * 1'  # Weekly on Monday at 3 AM UTC

jobs:
  accessibility:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Install accessibility tools
      run: |
        npm install -g pa11y-ci
        npm install -g axe-core @axe-core/cli
        
    - name: Wait for deployment (if running after push)
      if: github.event_name == 'push'
      run: sleep 120
      
    - name: Run Pa11y accessibility tests
      continue-on-error: true
      run: |
        # Use pa11y-ci with sitemap for comprehensive multi-page testing
        pa11y-ci --sitemap https://bibhu342.github.io/bibhuai/sitemap.xml \
          --threshold 10 \
          --ignore "color-contrast" || echo "Warning: Pa11y accessibility tests failed (non-blocking)"
          
    - name: Run Axe accessibility tests
      continue-on-error: true
      run: |
        axe https://bibhu342.github.io/bibhuai/ \
          --save axe-results.json \
          --tags wcag2a,wcag2aa || echo "Warning: Axe accessibility tests failed (non-blocking)"
          
    - name: Upload accessibility results
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: accessibility-results
        path: |
          axe-results.json
          pa11y-results.json
        retention-days: 30